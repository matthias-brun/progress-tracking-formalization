<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Graph</title>
</head>


<body>
<div class="head">
<h1>Theory Graph</h1>
</div>

<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Multigraphs with partially ordered weights›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Graph
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span> <a href="Antichain.html">Antichain</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">FROM</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FROM</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">LBL</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LBL</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="bound">l</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">TO</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">TO</span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">l</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="bound">t</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> subseq <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≼</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> graph <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">weights</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'vtx</span> <span class="main">::</span> finite <span class="main">⇒</span> <span class="tfree">'vtx</span> <span class="main">⇒</span> <span class="tfree">'lbl</span> <span class="main">::</span> <span class="main">{</span>order<span class="main">,</span> monoid_add<span class="main">}</span> antichain"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero_le<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> plus_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s1</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s2</span> <span class="main">⟹</span> <span class="free">s3</span> <span class="main">≤</span> <span class="free">s4</span> <span class="main">⟹</span> <span class="free">s1</span> <span class="main">+</span> <span class="free">s3</span> <span class="main">≤</span> <span class="free">s2</span> <span class="main">+</span> <span class="free">s4</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> summary_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">weights</span> <span class="free">loc</span> <span class="free">loc</span> <span class="main">=</span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">+</span> <span class="free">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s'</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">+</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> plus_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s'</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span> plus_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s'</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s'</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Paths and general facts about them›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'vtx</span> <span class="main">⇒</span> <span class="tfree">'vtx</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'vtx</span> <span class="main">×</span> <span class="tfree">'lbl</span> <span class="main">×</span> <span class="tfree">'vtx</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  path0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">⟹</span> <span class="free">path</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">lbl</span></span></span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">weights</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> <span class="main">⟹</span> <span class="free">path</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">lbl</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">l3</span></span></span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> path0E<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> path_AppendE<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l3</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">l2</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">l2'</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> path <span class="free">l2</span> <span class="free">l3</span> <span class="free">ys</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l3</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rotate_tac</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">l3</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path.path <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> path_take_from<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> FROM <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">l2'</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l2'</span> <span class="main">(</span>take <span class="free">m</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">xs</span> <span class="skolem">lbl</span> <span class="skolem">l3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> take_append<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l2</span><span class="main">=</span><span class="free">l2'</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> linorder_not_less nth_append take_all<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> case_prod_conv less_Suc_eq nth_append nth_append_length<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> path_take_to<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> TO <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="free">l2'</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l2'</span> <span class="main">(</span>take <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">xs</span> <span class="skolem">lbl</span> <span class="skolem">l3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> case_prod_conv less_antisym nth_append_length path.path<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> path_determines_loc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l3</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="free">l2</span> <span class="main">=</span> <span class="free">l3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> path.cases<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> path_first_loc<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">loc</span> <span class="free">loc'</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> FROM <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">loc</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">xs</span> <span class="skolem">lbl</span> <span class="skolem">l3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> path0E <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> path_to_eq_from<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">loc1</span> <span class="free">loc2</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> FROM <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TO <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">xs</span> <span class="skolem">lbl</span> <span class="skolem">l3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> add.commute drop_eq_Nil hd_drop_conv_nth id_take_nth_drop linorder_not_less path_determines_loc path_take_to plus_1_eq_Suc take_hd_drop<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> path_singleton<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">weights</span> <span class="free">l1</span> <span class="free">l2</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l2</span> <span class="main">[</span><span class="main">(</span><span class="free">l1</span><span class="main">,</span><span class="free">s</span><span class="main">,</span><span class="free">l2</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> path.simps<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path.intros<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> path_appendE<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l3</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">l2</span><span class="main">.</span> path <span class="bound">l2</span> <span class="free">l3</span> <span class="free">ys</span> <span class="main">∧</span> path <span class="free">l1</span> <span class="bound">l2</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">l3</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">@</span><span class="free">ys</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path0 <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">xs</span> <span class="skolem">lbl</span> <span class="skolem">l3</span> <span class="skolem">xs'</span> <span class="skolem">ys'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> path<span class="main">(</span>1<span class="main">,</span>3-<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> append_eq_append_conv2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">l2</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">lbl</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">l3</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ys'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> us
      <span class="keyword1"><span class="command">using</span></span> path<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">xs'</span></span> <span class="quoted"><span class="skolem">us</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> us
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path.intros<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_replace_prefix<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l3</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l2</span> <span class="free">ys</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l3</span> <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> path_appendE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> path_trans <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> path_determines_loc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> drop_subseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> length <span class="free">xs</span> <span class="main">⟹</span> drop <span class="free">n</span> <span class="free">xs</span> <span class="main">≼</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> suffix_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="free">xs</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> take_subseq<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="free">xs</span> <span class="main">≼</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> map_take_subseq<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≼</span> map <span class="free">f</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subseq_map<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> path_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">xs'</span><span class="main">.</span> distinct <span class="bound">xs'</span> <span class="main">∧</span> path <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs'</span> <span class="main">∧</span> map LBL <span class="bound">xs'</span> <span class="main">≼</span> map LBL <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path0 <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">xs</span> <span class="skolem">lbl</span> <span class="skolem">l3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">xs'</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs'</span>"</span></span> <span class="quoted"><span class="quoted">"map LBL <span class="skolem">xs'</span> <span class="main">≼</span> map LBL <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">lbl</span><span class="main">,</span> <span class="skolem">l3</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">xs'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> length <span class="skolem">xs'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">!</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">lbl</span><span class="main">,</span> <span class="skolem">l3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> in_set_conv_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> m ih <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="main">(</span>take <span class="skolem">m</span> <span class="skolem">xs'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path_take_from<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> m ih path <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"take <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="main"><span class="main">@</span></span> <span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">l2</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">lbl</span></span><span class="main"><span class="main">,</span></span> <span class="skolem"><span class="skolem">l3</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> distinct_take take_Suc_conv_app_nth<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> path.intros<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ih<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subseq_order.order.trans take_map take_subseq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> ih path<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs'</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="skolem">l2</span><span class="main">,</span> <span class="skolem">lbl</span><span class="main">,</span> <span class="skolem">l3</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_edge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l1'</span><span class="main">,</span> <span class="free">lbl</span><span class="main">,</span> <span class="free">l2'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="free">lbl</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">weights</span> <span class="free">l1'</span> <span class="free">l2'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rotate_tac</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Path weights and facts›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sum_weights</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'lbl</span> list <span class="main">⇒</span> <span class="tfree">'lbl</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sum_weights</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> foldr <span class="main">(+)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">sum_path_weights</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> sum_weights <span class="main">(</span>map LBL <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_weightp</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> path <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="bound">xs</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> sum_path_weights <span class="bound">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sum_not_less_zero<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_le_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_le_zeroD<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> foldr_plus_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span> <span class="main">⟹</span> foldr <span class="main">(+)</span> <span class="free">xs</span> <span class="free">n</span> <span class="main">≤</span> foldr <span class="main">(+)</span> <span class="free">xs</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_weights_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_weights <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> sum_weights <span class="free">ys</span> <span class="main">+</span> sum_weights <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_summary_prepend_le<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_path_weights <span class="free">ys</span> <span class="main">≤</span> sum_path_weights <span class="free">xs</span> <span class="main">⟹</span> sum_path_weights <span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">≤</span> sum_path_weights <span class="main">(</span><span class="free">zs</span> <span class="main">@</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> plus_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_summary_append_le<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_path_weights <span class="free">ys</span> <span class="main">≤</span> sum_path_weights <span class="free">xs</span> <span class="main">⟹</span> sum_path_weights <span class="main">(</span><span class="free">ys</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span> <span class="main">≤</span> sum_path_weights <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus_mono map_append order_refl sum_weights_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> foldr_plus_zero_le<span class="main">:</span> <span class="quoted"><span class="quoted">"foldr <span class="main">(+)</span> <span class="free">xs</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">≤</span> foldr <span class="main">(+)</span> <span class="free">xs</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subseq_sum_weights_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≼</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sum_weights <span class="free">xs</span> <span class="main">≤</span> sum_weights <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_emb.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>list_emb_Nil <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>list_emb_Cons <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order_trans <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_plus<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>list_emb_Cons2 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order_trans <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> subseq_sum_path_weights_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map LBL <span class="free">xs</span> <span class="main">≼</span> map LBL <span class="free">ys</span> <span class="main">⟹</span> sum_path_weights <span class="free">xs</span> <span class="main">≤</span> sum_path_weights <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subseq_sum_weights_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_path_weights_take_le<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_path_weights <span class="main">(</span>take <span class="free">i</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> sum_path_weights <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subseq_sum_path_weights_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_weights_append_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_weights <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> sum_weights <span class="free">xs</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_path_weights_append_singleton<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_path_weights <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span><span class="free">l</span><span class="main">,</span><span class="free">x</span><span class="main">,</span><span class="free">l'</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> sum_path_weights <span class="free">xs</span> <span class="main">+</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">xs</span><span class="main">.</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">s'</span> <span class="main">=</span> sum_path_weights <span class="bound">xs</span> <span class="keyword1">in</span> <span class="bound">s'</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">∧</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">s'</span> <span class="main">∧</span> distinct <span class="bound">xs</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">s</span><span class="main">,</span><span class="bound">l2</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">xs</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">weights</span> <span class="bound">l1</span> <span class="bound">l2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path_weightp_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> path_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> xs xs'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> path_edge <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subseq_sum_path_weights_le<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_set_summaries<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">l2</span><span class="main">)</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">s</span><span class="main">,</span><span class="bound">l2</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Sigma UNIV <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span><span class="bound">l2</span><span class="main">)</span><span class="main">.</span> set_antichain <span class="main">(</span><span class="free">weights</span> <span class="bound">l1</span> <span class="bound">l2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> finite_summaries<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> distinct <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">l1</span><span class="main">,</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">l2</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">xs</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">weights</span> <span class="bound">l1</span> <span class="bound">l2</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_distinct_bounded<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">l1</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">l2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">l1</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">l2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">`</span></span> <span class="main"><span class="main">(</span></span>Sigma UNIV <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">l1</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">l2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> set_antichain <span class="main"><span class="main">(</span></span><span class="free"><span class="free">weights</span></span> <span class="bound"><span class="bound">l1</span></span> <span class="bound"><span class="bound">l2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_set_summaries<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_minimal_antichain_path_weightp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>minimal_antichain <span class="main">{</span><span class="bound">x</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_surj<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_summaries<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">sum_path_weights</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minimal_antichain_def image_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> aux<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* antichain of summaries along cycles-less paths (cycle-less = no edge repeated) *)</span>
<span class="keyword1"><span class="command">lift_definition</span></span> path_weight <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'vtx</span> <span class="main">⇒</span> <span class="tfree">'vtx</span> <span class="main">⇒</span> <span class="tfree">'lbl</span> antichain"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">l1</span> <span class="bound">l2</span><span class="main">.</span> minimal_antichain <span class="main">{</span><span class="bound">x</span><span class="main">.</span> path_weightp <span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_minimal_antichain_path_weightp
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≡</span> path_weight <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≠</span> <span class="keyword1">{}<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> in_path_weight<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">loc1</span> <span class="free">loc2</span> <span class="main">⟷</span> <span class="free">s</span> <span class="main">∈</span> minimal_antichain <span class="main">{</span><span class="bound">s</span><span class="main">.</span> path_weightp <span class="free">loc1</span> <span class="free">loc2</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> path_weight_refl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">loc</span> <span class="free">loc</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">loc</span> <span class="free">loc</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> sum_path_weights <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_weightp <span class="free">loc</span> <span class="free">loc</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_weightp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_path_weight in_minimal_antichain<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_in_minimal_antichain<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'lbl</span><span class="main">)</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∈</span> minimal_antichain <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_minimal_antichain <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sum_not_less_zero<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_weightp_distinct</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> distinct <span class="bound">xs</span> <span class="main">∧</span> path <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="bound">xs</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> sum_path_weights <span class="bound">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minimal_antichain_path_weightp_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"minimal_antichain <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span> <span class="main">=</span> minimal_antichain <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp_distinct <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path_weightp_def path_weightp_distinct_def minimal_antichain_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> path_distinct order.strict_iff_order subseq_sum_path_weights_le<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> le_less_trans path_distinct subseq_sum_weights_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_path_weightp_distinct<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp_distinct <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> path_weightp_distinct_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"sum_path_weights <span class="main"><span class="main">`</span></span> <span class="main"><span class="main">{</span></span><span class="bound"><span class="bound">xs</span></span><span class="main"><span class="main">.</span></span> distinct <span class="bound"><span class="bound">xs</span></span> <span class="main"><span class="main">∧</span></span> path <span class="free"><span class="free">l1</span></span> <span class="free"><span class="free">l2</span></span> <span class="bound"><span class="bound">xs</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_summaries<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_edge<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_weightp_distinct_nonempty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp_distinct <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> path_distinct <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_weightp_def path_weightp_distinct_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> path_weightp_distinct_member<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">s</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> path_weightp_distinct <span class="free">l1</span> <span class="free">l2</span> <span class="bound">s</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_weightp_def path_weightp_distinct_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> path_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subseq_sum_path_weights_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> minimal_antichain_path_weightp_member<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> minimal_antichain <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> path_weightp_distinct <span class="free">l1</span> <span class="free">l2</span> <span class="bound">s</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_weightp_distinct_member <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp_distinct <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> u finite <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> minimal_antichain <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> path_weightp_distinct <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> minimal_antichain_member<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> u <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minimal_antichain_path_weightp_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_path_weight<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l1</span> <span class="free">l2</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≤</span> sum_path_weights <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sum_path_weights <span class="free">xs</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_weightp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> minimal_antichain <span class="main">{</span><span class="bound">x</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l2</span> <span class="bound">x</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">≤</span> sum_path_weights <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize_elim</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> minimal_antichain_path_weightp_member<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_weight_conv_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l1</span> <span class="free">l2</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> path <span class="free">l1</span> <span class="free">l2</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> sum_path_weights <span class="bound">xs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> path <span class="free">l1</span> <span class="free">l2</span> <span class="bound">ys</span> <span class="main">⟶</span> <span class="main">¬</span> sum_path_weights <span class="bound">ys</span> <span class="main">&lt;</span> sum_path_weights <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_minimal_antichain path_weightp_def<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">optimal_path</span> <span class="free"><span class="bound"><span class="entity">loc1</span></span></span> <span class="free"><span class="bound"><span class="entity">loc2</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> path <span class="free"><span class="bound"><span class="entity">loc1</span></span></span> <span class="free"><span class="bound"><span class="entity">loc2</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">ys</span><span class="main">.</span> path <span class="free"><span class="bound"><span class="entity">loc1</span></span></span> <span class="free"><span class="bound"><span class="entity">loc2</span></span></span> <span class="bound">ys</span> <span class="main">⟶</span> <span class="main">¬</span> sum_path_weights <span class="bound">ys</span> <span class="main">&lt;</span> sum_path_weights <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_weight_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">loc1</span> <span class="free">loc2</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">⋀</span><span class="bound">xs</span><span class="main">.</span> optimal_path <span class="free">loc1</span> <span class="free">loc2</span> <span class="bound">xs</span> <span class="main">⟹</span> distinct <span class="bound">xs</span> <span class="main">⟹</span> sum_path_weights <span class="bound">xs</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize_elim</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_minimal_antichain path_weightp_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> path_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> loc1 loc2 xs xs'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">xs'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command">using</span></span> order.strict_iff_order subseq_sum_path_weights_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">using</span></span> less_le subseq_sum_path_weights_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> path_weight_elem_trans<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l1</span> <span class="free">l2</span> <span class="main">⟹</span> <span class="free">s'</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l2</span> <span class="free">l3</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l1</span> <span class="free">l3</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">+</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> ps1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>  <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l1</span> <span class="free">l2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ps2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l2</span> <span class="free">l3</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ps1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> path1<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l2</span> <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> sum_path_weights <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path_weight_path<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ps2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> path2<span class="main">:</span> <span class="quoted"><span class="quoted">"path <span class="free">l2</span> <span class="free">l3</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">=</span> sum_path_weights <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path_weight_path<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> path1<span class="main">(</span>1<span class="main">)</span> path2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="free">l1</span> <span class="free">l3</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> path1<span class="main">(</span>2<span class="main">)</span> path2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">+</span> <span class="free">s'</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> path_weightp <span class="free">l1</span> <span class="free">l3</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_weightp_def sum_weights_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>A</sub></span> path_weight <span class="free">l1</span> <span class="free">l3</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">+</span> <span class="free">s'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minimal_antichain_path_weightp_member<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>